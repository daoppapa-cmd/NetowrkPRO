<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Process Manager</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Font for Khmer Language (Kantumruy Pro) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Kantumruy Pro', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js",
        "firebase/database": "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js",
        "lucide-react": "https://esm.sh/lucide-react@0.378.0"
      }
    }
    </script>
</head>
<body class="bg-slate-100 text-slate-800 h-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { 
            getDatabase, ref, push, onValue, remove, set 
        } from 'firebase/database';
        import { 
            Router as RouterIcon, Server, Wifi, Monitor, Trash2, 
            Save, Activity, Network, MapPin, Plus, ChevronRight, 
            ChevronDown, LayoutDashboard, PlusCircle, ListTree, 
            X, Table2, Cable, Settings2, Zap, AlertTriangle
        } from 'lucide-react';

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyACYmcbqF1va2ZZc70zQQqjGZiV2hX0mbg",
            authDomain: "networkpro-a908c.firebaseapp.com",
            databaseURL: "https://networkpro-a908c-default-rtdb.firebaseio.com",
            projectId: "networkpro-a908c",
            storageBucket: "networkpro-a908c.firebasestorage.app",
            messagingSenderId: "407357564008",
            appId: "1:407357564008:web:dcaefa798888b6a9a407dd",
            measurementId: "G-08C31G5ZLS"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- Main Component ---
        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [routers, setRouters] = useState([]);
            const [loading, setLoading] = useState(true);
            const [stats, setStats] = useState({ routers: 0, switches: 0, computers: 0, aps: 0 });

            useEffect(() => {
                const dbRef = ref(db, 'network_structure/routers');
                const unsubscribe = onValue(dbRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const loadedRouters = Object.keys(data).map(key => ({
                            id: key, ...data[key]
                        }));
                        loadedRouters.sort((a, b) => b.createdAt - a.createdAt);
                        setRouters(loadedRouters);

                        let sCount = 0, cCount = 0, aCount = 0;
                        loadedRouters.forEach(r => {
                            if (r.switches) {
                                Object.values(r.switches).forEach(s => {
                                    sCount++;
                                    if (s.accessType === 'Computer') cCount += parseInt(s.computerCount || '0');
                                    if (s.accessType === 'AP (WIFI)') aCount += parseInt(s.apCount || '0');
                                });
                            }
                        });
                        setStats({ routers: loadedRouters.length, switches: sCount, computers: cCount, aps: aCount });
                    } else {
                        setRouters([]);
                        setStats({ routers: 0, switches: 0, computers: 0, aps: 0 });
                    }
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            return (
                <div className="flex h-screen bg-slate-100 font-sans text-slate-800 overflow-hidden">
                    <aside className="hidden md:flex w-64 flex-col bg-slate-900 text-white shadow-xl z-20">
                        <div className="p-6 flex items-center gap-3 border-b border-slate-800">
                            <div className="bg-blue-600 p-2 rounded-lg"><Network size={24} className="text-white" /></div>
                            <div><h1 className="font-bold text-lg tracking-wide">NetManager</h1><p className="text-xs text-slate-400">Pro Edition</p></div>
                        </div>
                        <nav className="flex-1 p-4 space-y-2">
                            <SidebarItem icon={<LayoutDashboard size={20} />} label="ផ្ទាំងគ្រប់គ្រង" active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} />
                            <SidebarItem icon={<ListTree size={20} />} label="បណ្តាញ Network" active={activeTab === 'list'} onClick={() => setActiveTab('list')} />
                            <SidebarItem icon={<PlusCircle size={20} />} label="បន្ថែមឧបករណ៍" active={activeTab === 'add'} onClick={() => setActiveTab('add')} />
                        </nav>
                        <div className="p-4 border-t border-slate-800">
                            <div className="flex items-center gap-2 text-xs text-slate-500">
                                <Activity size={12} className={loading ? "text-yellow-500 animate-pulse" : "text-green-500"} />
                                {loading ? 'Syncing...' : 'System Online'}
                            </div>
                        </div>
                    </aside>

                    <div className="flex-1 flex flex-col h-full overflow-hidden relative">
                        <header className="md:hidden bg-slate-900 text-white p-4 flex justify-between items-center shadow-md z-20">
                            <div className="flex items-center gap-2"><Network size={20} className="text-blue-400" /><span className="font-bold">NetManager</span></div>
                            <div className="text-xs px-2 py-1 bg-slate-800 rounded-full flex items-center gap-1"><Activity size={10} className={loading ? "text-yellow-400" : "text-green-400"} />{loading ? 'Sync' : 'Live'}</div>
                        </header>

                        <main className="flex-1 overflow-y-auto p-4 pb-24 md:p-8 md:pb-8 scroll-smooth">
                            <div className="max-w-5xl mx-auto">
                                {activeTab === 'dashboard' && <DashboardView stats={stats} routers={routers} />}
                                {activeTab === 'list' && <ListView routers={routers} db={db} />}
                                {activeTab === 'add' && <AddView routers={routers} db={db} onSuccess={() => setActiveTab('list')} />}
                            </div>
                        </main>

                        <div className="md:hidden absolute bottom-0 left-0 right-0 bg-white border-t border-slate-200 px-6 py-3 flex justify-between items-center z-30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                            <MobileNavItem icon={<LayoutDashboard size={24} />} label="Home" active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} />
                            <div className="-mt-8"><button onClick={() => setActiveTab('add')} className={`p-4 rounded-full shadow-lg transition-all ${activeTab === 'add' ? 'bg-blue-600 ring-4 ring-blue-100' : 'bg-slate-900'}`}><Plus size={24} className="text-white" /></button></div>
                            <MobileNavItem icon={<ListTree size={24} />} label="Network" active={activeTab === 'list'} onClick={() => setActiveTab('list')} />
                        </div>
                    </div>
                </div>
            );
        }

        const DashboardView = ({ stats, routers }) => (
            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div><h2 className="text-2xl font-bold text-slate-800">សង្ខេបពត៌មាន (Dashboard)</h2><p className="text-slate-500">ស្ថានភាពបណ្តាញទូទៅ</p></div>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <StatCard title="Routers" value={stats.routers} icon={<RouterIcon className="text-blue-500" />} color="bg-blue-50 border-blue-100" />
                    <StatCard title="Switches" value={stats.switches} icon={<Server className="text-indigo-500" />} color="bg-indigo-50 border-indigo-100" />
                    <StatCard title="Computers" value={stats.computers} icon={<Monitor className="text-emerald-500" />} color="bg-emerald-50 border-emerald-100" />
                    <StatCard title="APs" value={stats.aps} icon={<Wifi className="text-purple-500" />} color="bg-purple-50 border-purple-100" />
                </div>
                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Activity size={18} className="text-slate-400" />Router ថ្មីៗ</h3>
                    <div className="space-y-3">
                        {routers.slice(0, 3).map(r => (
                            <div key={r.id} className="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                                <div className="flex items-center gap-3">
                                    <div className="bg-white p-2 rounded-lg shadow-sm"><RouterIcon size={20} className="text-blue-600" /></div>
                                    <div><p className="font-bold text-sm text-slate-700">{r.aid}</p><p className="text-xs text-slate-400">{r.switches ? Object.keys(r.switches).length : 0} Switches connected</p></div>
                                </div>
                                <span className="text-xs font-mono text-slate-400">{new Date(r.createdAt).toLocaleDateString()}</span>
                            </div>
                        ))}
                        {routers.length === 0 && <p className="text-center text-slate-400 py-4">មិនទាន់មានទិន្នន័យ</p>}
                    </div>
                </div>
            </div>
        );

        const ListView = ({ routers, db }) => {
            // Modal State Management
            const [modal, setModal] = useState({ isOpen: false, title: '', message: '', onConfirm: null });

            const closeModal = () => setModal({ ...modal, isOpen: false });

            const confirmDeleteRouter = (id, e) => {
                if (e) { e.preventDefault(); e.stopPropagation(); }
                setModal({
                    isOpen: true,
                    title: 'លុប Router?',
                    message: 'តើអ្នកពិតជាចង់លុប Router នេះ និង Switch ទាំងអស់ដែលភ្ជាប់ក្នុងនោះមែនទេ? សកម្មភាពនេះមិនអាចត្រឡប់វិញបានទេ។',
                    onConfirm: async () => {
                        try {
                            await remove(ref(db, `network_structure/routers/${id}`));
                            closeModal();
                        } catch (err) { alert("Error: " + err.message); }
                    }
                });
            };

            const confirmDeleteSwitch = (routerId, switchId, e) => {
                if (e) { e.preventDefault(); e.stopPropagation(); }
                setModal({
                    isOpen: true,
                    title: 'លុប Switch?',
                    message: 'តើអ្នកពិតជាចង់លុប Switch នេះចេញពីប្រព័ន្ធមែនទេ?',
                    onConfirm: async () => {
                        try {
                            await remove(ref(db, `network_structure/routers/${routerId}/switches/${switchId}`));
                            closeModal();
                        } catch (err) { alert("Error: " + err.message); }
                    }
                });
            };

            return (
                <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div className="flex justify-between items-end">
                        <div><h2 className="text-2xl font-bold text-slate-800">រចនាសម្ព័ន្ធបណ្តាញ (Topology)</h2><p className="text-slate-500">បញ្ជីឧបករណ៍លម្អិត</p></div>
                    </div>
                    <div className="space-y-4">
                        {routers.map(router => (
                            <div key={router.id} className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden relative">
                                <div className="bg-slate-50/80 p-4 flex justify-between items-center border-b border-slate-100">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-blue-600 text-white p-2.5 rounded-xl shadow-blue-200 shadow-md"><RouterIcon size={20} /></div>
                                        <div>
                                            <h3 className="font-bold text-slate-800">{router.aid}</h3>
                                            <div className="flex items-center gap-2 text-xs text-slate-500">
                                                <span className="bg-slate-200 px-2 py-0.5 rounded text-slate-600 font-mono text-[10px]">ROUTER</span>
                                                <span className="text-slate-300">•</span>
                                                <span className="bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-mono text-[10px]">12 PORTS</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button 
                                        type="button" 
                                        onClick={(e) => confirmDeleteRouter(router.id, e)} 
                                        className="text-slate-400 hover:text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors cursor-pointer relative z-10"
                                        title="Delete Router"
                                    >
                                        <Trash2 size={20} />
                                    </button>
                                </div>
                                <div className="divide-y divide-slate-50">
                                    {router.switches ? Object.entries(router.switches).map(([sid, sw]) => (
                                        <div key={sid} className="p-4 flex flex-col md:flex-row md:items-center gap-4 hover:bg-slate-50 transition-colors relative">
                                            <div className="flex flex-col md:w-1/4 gap-2 border-r border-slate-100 pr-4">
                                                <div className="flex items-center gap-2 text-xs font-bold text-slate-500 uppercase">
                                                    <Cable size={14} className="text-blue-500" />
                                                    <span>ភ្ជាប់ទៅ Router Port: <span className="bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded">{sw.routerPort || 'N/A'}</span></span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <div className="bg-indigo-50 text-indigo-600 p-2 rounded-lg"><Server size={18} /></div>
                                                    <div>
                                                        <p className="font-semibold text-sm text-slate-700">{sw.name}</p>
                                                        <div className="flex flex-wrap gap-2 mt-1">
                                                            <span className="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-mono">SN: {sw.serialNumber}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2 text-[10px] mt-1">
                                                    {sw.switchType === 'POE' ? 
                                                        <span className="bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded flex items-center gap-1 font-bold"><Zap size={10} /> POE</span> : 
                                                        <span className="bg-gray-200 text-gray-700 px-2 py-0.5 rounded flex items-center gap-1 font-bold"><Settings2 size={10} /> Manage</span>
                                                    }
                                                    <span className="bg-slate-200 text-slate-600 px-2 py-0.5 rounded font-bold">{sw.switchPortCount || 0} Ports</span>
                                                </div>
                                            </div>

                                            <div className="flex-1 pl-2">
                                                <div className="flex flex-wrap gap-2">
                                                    {sw.accessType === 'Computer' ? (
                                                        <div className="flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-2 rounded-lg border border-blue-100 w-full md:w-auto">
                                                            <Monitor size={16} />
                                                            <div className="flex flex-col leading-none">
                                                                <span className="text-[10px] opacity-70 uppercase font-bold">Computer Connection</span>
                                                                <span className="text-sm font-bold mt-0.5">
                                                                    {sw.computerRow ? `Row ${sw.computerRow}${sw.computerSection} (PC1-${sw.computerCount})` : `${sw.computerCount} Units`}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className="flex items-center gap-2 bg-purple-50 text-purple-700 px-3 py-2 rounded-lg border border-purple-100 w-full md:w-auto">
                                                            <Wifi size={16} />
                                                            <div className="flex flex-col leading-none">
                                                                <span className="text-[10px] opacity-70 uppercase font-bold">AP Connection</span>
                                                                <span className="text-sm font-bold mt-0.5">{sw.apName} ({sw.apCount})</span>
                                                            </div>
                                                        </div>
                                                    )}
                                                    {sw.apLocation && (
                                                        <div className="flex items-center gap-1 text-xs text-slate-500 px-2 bg-slate-100 rounded self-center py-1">
                                                            <MapPin size={12} /> {sw.apLocation}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="flex justify-end border-l border-slate-100 pl-4">
                                                <button 
                                                    type="button" 
                                                    onClick={(e) => confirmDeleteSwitch(router.id, sid, e)} 
                                                    className="text-slate-400 hover:text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors cursor-pointer relative z-10"
                                                    title="Delete Switch"
                                                >
                                                    <X size={20} />
                                                </button>
                                            </div>
                                        </div>
                                    )) : <div className="p-4 text-center text-sm text-slate-400 italic">មិនទាន់មាន Switch ភ្ជាប់ទេ</div>}
                                </div>
                            </div>
                        ))}
                        {routers.length === 0 && <div className="text-center py-12 text-slate-400"><LayoutDashboard size={48} className="mx-auto mb-3 opacity-20" /><p>មិនមានទិន្នន័យនៅក្នុងប្រព័ន្ធ</p></div>}
                    </div>

                    {/* --- CUSTOM MODAL POPUP --- */}
                    {modal.isOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-in zoom-in-95 duration-200 scale-100 border border-slate-100">
                                <div className="p-6 text-center">
                                    <div className="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 border border-red-100 shadow-sm">
                                        <Trash2 size={30} className="text-red-500" />
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-800 mb-2">{modal.title}</h3>
                                    <p className="text-slate-500 text-sm mb-6 leading-relaxed px-2">{modal.message}</p>
                                    <div className="flex gap-3 justify-center">
                                        <button 
                                            onClick={closeModal}
                                            className="px-5 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors text-sm w-full"
                                        >
                                            បោះបង់
                                        </button>
                                        <button 
                                            onClick={modal.onConfirm}
                                            className="px-5 py-2.5 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700 shadow-lg shadow-red-200 transition-all text-sm w-full"
                                        >
                                            យល់ព្រម
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const AddView = ({ routers, db, onSuccess }) => {
            const [mode, setMode] = useState('switch');
            const [loading, setLoading] = useState(false);
            const [rName, setRName] = useState('');

            // Switch State
            const [sRouter, setSRouter] = useState('');
            const [sRouterPort, setSRouterPort] = useState('1'); // Default Port 1
            const [sName, setSName] = useState('');
            const [sSn, setSSn] = useState('');
            const [sSwitchType, setSSwitchType] = useState('Manage'); // Manage or POE
            const [sSwitchPortCount, setSSwitchPortCount] = useState('24'); // Default 24 ports
            
            const [sType, setSType] = useState('Computer');
            const [cCount, setCCount] = useState('');
            const [cRow, setCRow] = useState('');
            const [cSection, setCSection] = useState('A');
            const [apCount, setApCount] = useState('');
            const [apName, setApName] = useState('');
            const [apLoc, setApLoc] = useState('');

            const submitRouter = async (e) => {
                e.preventDefault(); if(!rName) return; setLoading(true);
                try { await set(push(ref(db, 'network_structure/routers')), { aid: rName, createdAt: Date.now() }); setRName(''); alert("បង្កើត Router ជោគជ័យ!"); } catch(e) { alert(e); } setLoading(false);
            };

            const submitSwitch = async (e) => {
                e.preventDefault(); if(!sRouter || !sName) return; setLoading(true);
                try {
                    const payload = { 
                        name: sName, serialNumber: sSn, 
                        routerPort: sRouterPort, switchType: sSwitchType, switchPortCount: sSwitchPortCount,
                        accessType: sType, createdAt: Date.now() 
                    };
                    if(sType === 'Computer') { payload.computerCount = cCount; payload.computerRow = cRow; payload.computerSection = cSection; }
                    else { payload.apCount = apCount; payload.apName = apName; payload.apLocation = apLoc; }
                    
                    await set(push(ref(db, `network_structure/routers/${sRouter}/switches`)), payload);
                    setSName(''); setSSn(''); setCCount(''); setCRow(''); setCSection('A'); setApCount(''); setApName(''); setApLoc('');
                    onSuccess();
                } catch(e) { alert(e); } setLoading(false);
            };

            return (
                <div className="max-w-xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div className="text-center mb-8"><h2 className="text-2xl font-bold text-slate-800">បន្ថែមឧបករណ៍</h2><p className="text-slate-500">ពង្រីកហេដ្ឋារចនាសម្ព័ន្ធបណ្តាញ</p></div>
                    <div className="bg-slate-200 p-1 rounded-xl flex mb-8">
                        <button onClick={() => setMode('router')} className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${mode === 'router' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>New Router</button>
                        <button onClick={() => setMode('switch')} className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${mode === 'switch' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>New Switch</button>
                    </div>

                    <div className="bg-white rounded-2xl shadow-lg border border-slate-100 p-6 md:p-8">
                        {mode === 'router' ? (
                            <form onSubmit={submitRouter} className="space-y-6">
                                <div><label className="text-xs font-bold text-slate-500 uppercase">Mikrotik AID</label><input value={rName} onChange={e => setRName(e.target.value)} className="w-full mt-2 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="MK-01" /></div>
                                <button disabled={loading} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-blue-200">{loading ? 'Creating...' : 'បង្កើត Router'}</button>
                            </form>
                        ) : (
                            <form onSubmit={submitSwitch} className="space-y-5">
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="col-span-1">
                                        <label className="text-xs font-bold text-slate-500 uppercase">ជ្រើសរើស Router</label>
                                        <div className="relative mt-2">
                                            <select value={sRouter} onChange={e => setSRouter(e.target.value)} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl appearance-none outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="">-- Select --</option>
                                                {routers.map(r => <option key={r.id} value={r.id}>{r.aid}</option>)}
                                            </select>
                                            <ChevronDown className="absolute right-4 top-3.5 text-slate-400 pointer-events-none" size={16} />
                                        </div>
                                    </div>
                                    <div className="col-span-1">
                                        <label className="text-xs font-bold text-slate-500 uppercase">ភ្ជាប់ទៅ Router Port</label>
                                        <div className="relative mt-2">
                                            <select value={sRouterPort} onChange={e => setSRouterPort(e.target.value)} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl appearance-none outline-none focus:ring-2 focus:ring-blue-500">
                                                {[...Array(12)].map((_, i) => <option key={i+1} value={i+1}>Port {i+1}</option>)}
                                            </select>
                                            <Cable className="absolute right-4 top-3.5 text-slate-400 pointer-events-none" size={16} />
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-100 space-y-4">
                                    <h3 className="text-sm font-bold text-slate-700 flex items-center gap-2"><Settings2 size={16} />Switch Configuration</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="text-xs font-bold text-slate-500 uppercase">ឈ្មោះ Switch</label>
                                            <input value={sName} onChange={e => setSName(e.target.value)} className="w-full mt-2 p-2 bg-white border border-slate-200 rounded-lg outline-none" placeholder="SW-01" />
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-slate-500 uppercase">Serial No.</label>
                                            <input value={sSn} onChange={e => setSSn(e.target.value)} className="w-full mt-2 p-2 bg-white border border-slate-200 rounded-lg outline-none" placeholder="SN..." />
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-slate-500 uppercase">ប្រភេទ Switch</label>
                                            <select value={sSwitchType} onChange={e => setSSwitchType(e.target.value)} className="w-full mt-2 p-2 bg-white border border-slate-200 rounded-lg outline-none">
                                                <option value="Manage">Manage</option>
                                                <option value="POE">POE</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-slate-500 uppercase">ចំនួន Port របស់ Switch</label>
                                            <input type="number" value={sSwitchPortCount} onChange={e => setSSwitchPortCount(e.target.value)} className="w-full mt-2 p-2 bg-white border border-slate-200 rounded-lg outline-none" placeholder="24" />
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label className="text-xs font-bold text-slate-500 uppercase mb-2 block">ប្រភេទនៃការតភ្ជាប់ (Access)</label>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div onClick={() => setSType('Computer')} className={`p-3 rounded-xl border-2 cursor-pointer transition-all flex flex-col items-center gap-2 ${sType === 'Computer' ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-100'}`}><Monitor size={20} /> <span className="text-xs font-bold">Computer</span></div>
                                        <div onClick={() => setSType('AP (WIFI)')} className={`p-3 rounded-xl border-2 cursor-pointer transition-all flex flex-col items-center gap-2 ${sType === 'AP (WIFI)' ? 'border-purple-500 bg-purple-50 text-purple-700' : 'border-slate-100'}`}><Wifi size={20} /> <span className="text-xs font-bold">AP (Wifi)</span></div>
                                    </div>
                                </div>

                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                    {sType === 'Computer' ? (
                                        <div className="space-y-3">
                                            <div className="grid grid-cols-2 gap-3">
                                                 <div>
                                                    <label className="text-xs font-bold text-slate-500 uppercase">លេខតុ (Row)</label>
                                                    <div className="relative mt-1">
                                                        <Table2 size={16} className="absolute left-3 top-2.5 text-slate-400" />
                                                        <input type="number" value={cRow} onChange={e => setCRow(e.target.value)} className="w-full pl-9 p-2 bg-white border border-slate-200 rounded-lg outline-none" placeholder="1" />
                                                    </div>
                                                 </div>
                                                 <div>
                                                    <label className="text-xs font-bold text-slate-500 uppercase">ផ្នែក (Section)</label>
                                                    <select value={cSection} onChange={e => setCSection(e.target.value)} className="w-full mt-1 p-2 bg-white border border-slate-200 rounded-lg outline-none"><option value="A">A</option><option value="B">B</option></select>
                                                 </div>
                                            </div>
                                            <div><label className="text-xs font-bold text-slate-500 uppercase">ចំនួន Computer</label><input type="number" value={cCount} onChange={e => setCCount(e.target.value)} className="w-full mt-2 p-3 bg-white border border-slate-200 rounded-xl outline-none" placeholder="6" /></div>
                                            {(cRow && cCount) && <div className="text-xs text-blue-600 bg-blue-50 p-3 rounded-lg border border-blue-100 flex gap-2 items-start"><Monitor size={14} className="mt-0.5 shrink-0" /><span><strong>គំរូឈ្មោះ:</strong> PC1Row{cRow}{cSection} ... PC{cCount}Row{cRow}{cSection}</span></div>}
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="text-xs font-bold text-slate-500 uppercase">ចំនួន AP</label><input type="number" value={apCount} onChange={e => setApCount(e.target.value)} className="w-full mt-1 p-2 bg-white border border-slate-200 rounded-lg outline-none" /></div>
                                                <div><label className="text-xs font-bold text-slate-500 uppercase">ឈ្មោះ SSID</label><input value={apName} onChange={e => setApName(e.target.value)} className="w-full mt-1 p-2 bg-white border border-slate-200 rounded-lg outline-none" /></div>
                                            </div>
                                            <div><label className="text-xs font-bold text-slate-500 uppercase">ទីតាំង</label><input value={apLoc} onChange={e => setApLoc(e.target.value)} className="w-full mt-1 p-2 bg-white border border-slate-200 rounded-lg outline-none" placeholder="e.g. ជាន់ទី 1" /></div>
                                        </div>
                                    )}
                                </div>
                                <button disabled={loading} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-indigo-200">{loading ? 'Saving...' : 'រក្សាទុក Switch'}</button>
                            </form>
                        )}
                    </div>
                </div>
            );
        };

        const SidebarItem = ({ icon, label, active, onClick }) => (
            <button onClick={onClick} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${active ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>{icon}<span className="font-medium text-sm">{label}</span></button>
        );
        const MobileNavItem = ({ icon, label, active, onClick }) => (
            <button onClick={onClick} className={`flex flex-col items-center gap-1 ${active ? 'text-blue-600' : 'text-slate-400'}`}>{icon}<span className="text-[10px] font-medium">{label}</span></button>
        );
        const StatCard = ({ title, value, icon, color }) => (
            <div className={`p-4 rounded-2xl border ${color} flex flex-col items-center justify-center text-center shadow-sm`}><div className="mb-2 bg-white p-2 rounded-full shadow-sm">{icon}</div><span className="text-2xl font-bold text-slate-800">{value}</span><span className="text-xs text-slate-500 uppercase tracking-wider">{title}</span></div>
        );

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
